<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ff8fb2" />
  <title>MafiaCats â€“ Game (Middenpaneel weergaven)</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --accent:#ff8fb2; --accent-600:#ff6f9c; --lav:#cdb4f5; }
    body{ background:#fff6f8; font-family:'Outfit',sans-serif; color:#2e2a2c; }
    .panel{ background:#fff; border:1px solid #f4d4e0; border-radius:1rem; box-shadow:0 4px 16px rgba(0,0,0,.05); }
    .btn{ font-weight:600; transition:.15s; }
    .btn:hover{ transform:translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,.1); }
    .bar{ height:8px; border-radius:999px; background:#ffe1ec; overflow:hidden }
    .bar>i{ display:block; height:100%; background:linear-gradient(90deg, var(--accent), var(--lav)); }
    .xbar{ height:6px; border-radius:999px; background:#f7e7ef; overflow:hidden }
    .xbar>i{ display:block; height:100%; background:linear-gradient(90deg, #ffc1d6, #cdb4f5); }
    .pill{ font-size:.7rem; padding:.15rem .45rem; border-radius:999px; background:#fff1f6; border:1px solid #ffd6e5; color:#9b3b62; }
    .tag{ font-size:.72rem; padding:.25rem .55rem; border-radius:.7rem; background:#ffe3ef; border:1px solid #ffcfe2; color:#7d2a4b; }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Header -->
  <header class="px-4 py-2 bg-white/85 backdrop-blur border-b border-pink-200 flex items-center justify-between">
    <a href="index.html" class="flex items-center gap-2 font-extrabold text-lg">ğŸ¾ Mafia<span class="text-pink-500">Cats</span></a>
    <div class="flex items-center gap-3 text-sm">
      <span class="hidden md:flex items-center gap-3">
        <span>ğŸ¥« <b id="hudCash">10</b></span>
        <span>ğŸ’– <b id="hudHP">9</b></span>
        <span>ğŸ’¤ <b id="hudEN">100%</b></span>
        <span>ğŸ¶ <b id="hudHeat">0%</b></span>
        <span>âœ¨ <b id="hudRep">0</b></span>
      </span>
      <button id="saveBtn" class="btn px-3 py-1.5 rounded-lg bg-black/5 hover:bg-black/10">Opslaan</button>
      <button id="resetBtn" class="btn px-3 py-1.5 rounded-lg bg-pink-200 hover:bg-pink-300">Reset</button>
    </div>
  </header>

  <!-- Layout -->
  <main class="flex-1 max-w-7xl mx-auto w-full p-3 md:p-4 grid lg:grid-cols-[320px_1fr_320px] gap-3 md:gap-4 overflow-hidden" style="height:calc(100vh - 56px)">
    <!-- Left: Character + Actieknoppen -->
    <aside class="flex flex-col gap-3 md:gap-4 overflow-hidden">
      <div class="panel p-4 sticky top-3">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-full bg-pink-200 flex items-center justify-center text-2xl">ğŸ±</div>
          <div class="grow">
            <input id="charName" class="w-full bg-pink-50/50 border border-pink-200 rounded-lg px-2 py-1 text-sm" placeholder="Jouw kattennaam"/>
            <p class="text-xs text-black/60 mt-1">Rang: <span id="rank">Kittenspion</span> Â· Dag <span id="day">1</span></p>
          </div>
        </div>
        <div class="mt-3 space-y-2 text-xs">
          <div>ğŸ’¤ Energie <span class="float-right" id="en">100%</span></div>
          <div class="bar"><i id="enBar" style="width:100%"></i></div>
          <div>ğŸ¶ Alert <span class="float-right" id="heat">0%</span></div>
          <div class="bar"><i id="heatBar" style="width:0%"></i></div>
          <div class="grid grid-cols-3 gap-2 text-center mt-2">
            <div class="panel p-2"><div class="text-lg" id="cash">10</div><div class="text-[10px] text-black/60">ğŸ¥« Blikvoer</div></div>
            <div class="panel p-2"><div class="text-lg" id="hp">9</div><div class="text-[10px] text-black/60">ğŸ’– Levens</div></div>
            <div class="panel p-2"><div class="text-lg" id="rep">0</div><div class="text-[10px] text-black/60">âœ¨ Purr</div></div>
          </div>
          <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
            <button id="nextDay" class="btn px-3 py-2 rounded-lg bg-pink-500 text-white">Volgende dag</button>
            <button id="restBtn" class="btn px-3 py-2 rounded-lg bg-black/5 hover:bg-black/10">Rust</button>
          </div>

          <!-- Actieknoppen die middenpaneel openen -->
          <div class="mt-3 grid grid-cols-1 gap-2">
            <button id="openHeists" class="btn w-full px-4 py-3 rounded-xl bg-[var(--accent)] hover:bg-[var(--accent-600)] text-white">Overvallen</button>
          </div>
        </div>
      </div>

      <!-- Werk blijft in de linkerkolom -->
      <section class="panel p-3 md:p-4 overflow-auto">
        <h2 class="font-semibold mb-2">Werk</h2>
        <ul class="space-y-2 text-sm" id="workList"></ul>
      </section>
    </aside>

    <!-- Middle: wisselende weergave -->
    <section id="centerPanel" class="panel p-3 md:p-4 overflow-auto">
      <div class="flex items-center justify-between mb-2">
        <h2 id="centerTitle" class="text-lg font-extrabold">Stad & Logboek</h2>
        <div class="text-xs"><span id="centerTag" class="tag">v0.3</span></div>
      </div>

      <!-- feedbackbalk -->
      <div id="centerResult" class="hidden mb-3 p-3 rounded-xl border"></div>

      <!-- log -->
      <div id="logView">
        <div id="log" class="space-y-1 text-sm"></div>
      </div>

      <!-- overvallen -->
      <div id="heistsView" class="hidden">
        <p class="text-sm text-black/70 mb-3">
          Begin bovenaan bij de makkelijke doelen. Elke poging geeft <b>XP</b> â€” meer XP = hogere <b>slagingskans</b>.
          Items zoals de <i>laserpen</i> helpen ook. Let op je <b>energie</b> en <b>honden-alert</b>!
        </p>
        <ul id="heistListCenter" class="space-y-2 text-sm"></ul>
        <div class="mt-4">
          <button data-nav="log" class="btn px-4 py-2 rounded-lg bg-black/5 hover:bg-black/10">â† Terug naar Logboek</button>
        </div>
      </div>

      <!-- shop -->
      <div id="shopView" class="hidden">
        <p class="text-sm text-black/70 mb-3">
          Besteed je <b>blikvoer</b> aan items. Sommige items (zoals de <i>laserpen</i>) verhogen je slagingskans bij overvallen.
        </p>
        <ul id="shopListCenter" class="text-sm space-y-2"></ul>
        <div class="mt-4">
          <button data-nav="log" class="btn px-4 py-2 rounded-lg bg-black/5 hover:bg-black/10">â† Terug naar Logboek</button>
        </div>
      </div>

      <!-- inventaris -->
      <div id="invView" class="hidden">
        <p class="text-sm text-black/70 mb-3">Gebruik items voor herstel of voordeel. Sommige zijn verbruiksitems.</p>
        <ul id="invListCenter" class="text-sm space-y-2"></ul>
        <div class="mt-4">
          <button data-nav="log" class="btn px-4 py-2 rounded-lg bg-black/5 hover:bg-black/10">â† Terug naar Logboek</button>
        </div>
      </div>
    </section>

    <!-- Right: nu alleen knoppen die middenpaneel openen -->
    <aside class="flex flex-col gap-3 md:gap-4 overflow-hidden">
      <section class="panel p-4 sticky top-3">
        <h3 class="font-semibold mb-2">Snelkoppelingen</h3>
        <div class="grid grid-cols-1 gap-2">
          <button id="openShop" class="btn w-full px-4 py-2 rounded-lg bg-black/5 hover:bg-black/10">Kattenshop</button>
          <button id="openInv" class="btn w-full px-4 py-2 rounded-lg bg-black/5 hover:bg-black/10">Inventaris</button>
        </div>
      </section>
    </aside>
  </main>

  <script>
    const $=(s,r=document)=>r.querySelector(s); const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
    const SAVE_KEY='mafiacats_save_v3';
    const state=load()||{name:'',cash:10,hp:9,en:100,rep:0,heat:0,day:1,items:{kruid:0,laser:0,muis:0,halsband:0},xp:{heist:{},work:{}},seed:Math.floor(Math.random()*1e9)};

    const HEISTS=[
      {key:'visboer', name:'Jat vis bij de visboer', base:0.55, cost:10, payout:[4,9], rep:2, heatS:6, heatF:8, hpF:1, emoji:'ğŸŸ'},
      {key:'keukenkast', name:'Inbreken in keukenkast (mensen)', base:0.45, cost:12, payout:[6,13], rep:3, heatS:8, heatF:10, hpF:1, emoji:'ğŸ½ï¸'},
      {key:'magazijn', name:'Supermarkt-magazijn', base:0.35, cost:16, payout:[10,18], rep:4, heatS:10, heatF:12, hpF:1, emoji:'ğŸ“¦'},
      {key:'melkfabriek', name:'Overval op melkfabriek', base:0.27, cost:20, payout:[14,26], rep:5, heatS:12, heatF:16, hpF:1, emoji:'ğŸ¥›'},
      {key:'dierenwinkel', name:'Dierenwinkel-raid', base:0.20, cost:22, payout:[20,34], rep:7, heatS:14, heatF:20, hpF:2, emoji:'ğŸ¾'}
    ];
    const WORK=[
      {key:'knuffel', name:'Poseren als knuffel', cost:8, payout:[3,7], rep:1, emoji:'ğŸ§¸'},
      {key:'ratten', name:'Ratten vangen in de haven', cost:10, payout:[5,10], rep:2, emoji:'ğŸ­'},
      {key:'chauffeur', name:'Dozen-mobiel chauffeur', cost:12, payout:[7,12], rep:2, heat:3, emoji:'ğŸšš'}
    ];

    function rng(){ state.seed=(state.seed*1664525+1013904223)>>>0; return (state.seed>>>0)/4294967296; }
    const clamp=(n,min=0,max=100)=>Math.max(min,Math.min(max,n));
    const pct=(x)=> Math.round(x*100);

    function save(){ localStorage.setItem(SAVE_KEY, JSON.stringify(state)); toast('ğŸ’¾ Opgeslagen'); }
    function load(){ try{ const raw=localStorage.getItem(SAVE_KEY); return raw?JSON.parse(raw):null }catch{return null} }
    function reset(){ localStorage.removeItem(SAVE_KEY); Object.assign(state,{name:'',cash:10,hp:9,en:100,rep:0,heat:0,day:1,items:{kruid:0,laser:0,muis:0,halsband:0},xp:{heist:{},work:{}},seed:Math.floor(Math.random()*1e9)}); update(); log('ğŸ”„ Reset voltooid.'); }

    // ---------- UI state ----------
    function showView(kind){
      // verberg alles
      $('#logView').classList.add('hidden');
      $('#heistsView').classList.add('hidden');
      $('#shopView').classList.add('hidden');
      $('#invView').classList.add('hidden');
      $('#centerResult').classList.add('hidden');

      // toon gekozen
      if(kind==='log'){ $('#centerTitle').textContent='Stad & Logboek'; $('#logView').classList.remove('hidden'); }
      if(kind==='heists'){ $('#centerTitle').textContent='Overvallen'; $('#heistsView').classList.remove('hidden'); renderHeists('heistListCenter'); }
      if(kind==='shop'){ $('#centerTitle').textContent='Kattenshop'; $('#shopView').classList.remove('hidden'); renderShop(); }
      if(kind==='inv'){ $('#centerTitle').textContent='Inventaris'; $('#invView').classList.remove('hidden'); renderInvCenter(); }
    }

    // ---------- stats helpers ----------
    function updateHUD(){
      $('#cash').textContent=state.cash; $('#hp').textContent=state.hp; $('#en').textContent=state.en+'%'; $('#heat').textContent=state.heat+'%'; $('#rep').textContent=state.rep;
      $('#day').textContent=state.day; $('#rank').textContent=rank(); $('#enBar').style.width=clamp(state.en)+'%'; $('#heatBar').style.width=clamp(state.heat)+'%';
      $('#hudCash').textContent=state.cash; $('#hudHP').textContent=state.hp; $('#hudEN').textContent=state.en+'%'; $('#hudHeat').textContent=state.heat+'%'; $('#hudRep').textContent=state.rep;
      $('#charName').value=state.name||'';
    }
    function update(){ updateHUD(); renderWork(); }

    function rank(){ const R=[{n:'Kittenspion',r:0},{n:'Straatkat',r:30},{n:'Klapkat',r:80},{n:'Miauwster',r:150},{n:'Katerbaas',r:250},{n:'Oude wijze poes',r:400},{n:'Don Purrino',r:700}]; let cur=R[0].n; for(const r of R){ if(state.rep>=r.r) cur=r.n; else break;} return cur; }

    function spend(c){ if(state.en<c){ toast('ğŸ˜´ Te moe om te miauwen.'); return false;} state.en=clamp(state.en-c); return true; }
    function addCash(c){ state.cash=Math.max(0,state.cash+c); }
    function addHP(h){ state.hp=Math.max(0,state.hp+h); }
    function addRep(r){ state.rep=Math.max(0,state.rep+r); }
    function addHeat(h){ state.heat=clamp(state.heat+h); }

    // ---------- Heists ----------
    function heistChance(h){
      const xp = (state.xp.heist[h.key]||0);
      let chance = h.base + (xp*0.005) + (state.items.laser*0.03); // +0,5% per XP, +3% per laser
      return Math.min(chance, 0.9);
    }
    function doHeist(key){
      const h = HEISTS.find(x=>x.key===key); if(!h) return;
      if(!spend(h.cost)) return;
      const chance = heistChance(h);
      const roll = rng();
      if(roll < chance){
        const gain = h.payout[0] + Math.floor(rng() * (h.payout[1]-h.payout[0]+1));
        addCash(gain); addRep(h.rep); addHeat(h.heatS); state.xp.heist[key]=(state.xp.heist[key]||0)+3;
        showResult(`âœ… Succes: ${h.name}. +${gain} blikvoer, +${h.rep} purr, +alert.`);
        log(`âœ… ${h.emoji} Succes: ${h.name}. +${gain} blikvoer, +${h.rep} purr, +alert.`);
      } else {
        addHP(-h.hpF); addHeat(h.heatF); state.xp.heist[key]=(state.xp.heist[key]||0)+1;
        showResult(`âŒ Mislukt: ${h.name}. âˆ’${h.hpF} leven, +alert.`);
        log(`âŒ ${h.emoji} Mislukt: ${h.name}. âˆ’${h.hpF} leven, +alert.`);
      }
      update(); check(); renderHeists('heistListCenter');
    }
    function renderHeists(ulId){
      const ul=document.getElementById(ulId); ul.innerHTML='';
      HEISTS.forEach(h=>{
        const xp = state.xp.heist[h.key]||0; const ch=heistChance(h);
        const li=document.createElement('li'); li.className='flex items-center gap-3 bg-pink-50 rounded-xl px-3 py-2 border border-pink-100';
        li.innerHTML = `
          <div class="text-xl">${h.emoji}</div>
          <div class="grow min-w-0">
            <div class="flex items-center justify-between gap-2">
              <p class="font-semibold truncate">${h.name}</p>
              <span class="text-xs">Kans: <b>${pct(ch)}%</b></span>
            </div>
            <p class="text-xs text-black/60">Energie ${h.cost} Â· Buit ${h.payout[0]}â€“${h.payout[1]} Â· Purr +${h.rep}</p>
            <div class="xbar mt-1"><i style="width:${Math.min(100, xp)}%"></i></div>
          </div>
          <button class="btn px-3 py-1.5 rounded-lg bg-[var(--accent)] hover:bg-[var(--accent-600)] text-white whitespace-nowrap" data-heist="${h.key}">Doe overval</button>
        `;
        ul.appendChild(li);
      });
      $$('[data-heist]', ul).forEach(b=> b.addEventListener('click', ()=> doHeist(b.getAttribute('data-heist'))));
    }

    // ---------- Werk ----------
    function doWork(key){
      const w = WORK.find(x=>x.key===key); if(!w) return;
      if(!spend(w.cost)) return;
      const base = w.payout[0]; const extra = Math.floor(rng()*(w.payout[1]-w.payout[0]+1));
      const xp = (state.xp.work[w.key]||0);
      const bonus = Math.floor(xp*0.05);
      addCash(base+extra+bonus); addRep(w.rep); if(w.heat) addHeat(w.heat);
      state.xp.work[w.key]=(state.xp.work[w.key]||0)+2;
      log(`${w.emoji} Werk: ${w.name}. +${base+extra+bonus} blikvoer${w.heat? ", +alert":""}.`);
      update();
    }
    function renderWork(){
      const ul=$('#workList'); ul.innerHTML='';
      WORK.forEach(w=>{
        const xp = state.xp.work[w.key]||0;
        const li=document.createElement('li'); li.className='flex items-center gap-3 bg-white rounded-xl px-3 py-2 border border-pink-100';
        li.innerHTML = `
          <div class="text-xl">${w.emoji}</div>
          <div class="grow min-w-0">
            <div class="flex items-center justify-between gap-2">
              <p class="font-semibold truncate">${w.name}</p>
              <span class="text-xs">Energie ${w.cost}</span>
            </div>
            <p class="text-xs text-black/60">Beloning ${w.payout[0]}â€“
